<!DOCTYPE html>
<html>
	<head>
		<title>PARCIAL</title>
		<style>
			body { margin: 0; }
			canvas { display: block; }
	#info {
                position: absolute;
                padding: 10px;
                width: 100%;
                text-align: center;
                color: #FFFFFF;
		</style>
	</head>
	<body>
	<div id="info">ROTACIÓN CON ÁNGULOS DE EULER LA CAMARA <br/>
          Usar teclas <br/>
		A para rotar camara en  eje Y<br/>
		S para rotar camara en  eje X<br/>
		D para rotar camara en  eje Z <br/>
		Usar flecha arriba y abajo para trasladar araña.<br/>
	        Usar flechas laterales para rotar araña.<br/>
    	</div>
		<script src="js/three.min.js"></script>
		<script>
//SET UP SCENE & CAMERA
	var scene;
	var camera;

//SET UP SHAPES & MATERIAL
	var geometry;
	var material1 = new THREE.PointsMaterial( { color: 0xFFFFFF, size: 0.1 });
	var mesh;
	var aKey = false;
        var sKey = false;
        var dKey = false;
	var object;
        var RX = 0;
        var RY = 0;
        var RZ = 0;
	var scene, aspect, camera, renderer;
	var geometry1, geometry2;
	var hips, torso, head;
	var rightFoot, rightLeg, rightArm, rightHand;
	var leftFoot, leftLeg, leftArm, leftHand;
	var startTime = Date.now();
		
	var axesHelper1 = new THREE.AxesHelper( 1 );
			
	var upArrow = false;
	var downArrow = false;
	var leftArrow = false;
	var rightArrow = false;
	var thetaSum=0;
	var positivo=false;

/* 
  add geomerty and material to mesh.
  mesh(geomerty, matrial)
*/

//RENDER THE SCENE
	var renderer;

	init();
	animate();

	function init() {

	  scene = new THREE.Scene();
	  camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 10000); /* 10000 the vanishing point(how far you can see) */


//set size to full screen
	renderer = new THREE.WebGLRenderer({antialias:true});
	renderer.setSize(window.innerWidth, window.innerHeight);

//add to the DOM
	document.body.appendChild(renderer.domElement);

// PRIMER EDIFICIO BLOQUE PISO
var material = new THREE.PointsMaterial();
  var geometry = new THREE.BoxGeometry(10,1,10);
  var cube1 = new THREE.Points( geometry, material );
  
cube1.position.y=0.75;
cube1.position.z=0;
cube1.position.x=1.25;

  //increase the steps to make squares bigger. must be divisible by the size
  var size = 50,
    steps = 0.5;

  geometry = new THREE.Geometry();
  material = new THREE.LineBasicMaterial({
    color: 'teal'
  });
	
	var onKeyDown = function ( event ) {
				switch ( event.keyCode ) {
					case 65: // ROTAR X
						aKey = true;
						break;
					case 83: // ROTAR Y
						sKey = true;
						break;
                   			case 68: // ROTAR Z
						dKey = true;
						break;
					case 38: // TRASLADAR ADELANTE
						upArrow = true;
						break;
					case 40: // TRASLADAR ATRÁS
						downArrow = true;
						break;
					case 37: // ROTAR CW
						leftArrow = true;
						break;
					case 39: // ROTAR CCW
						rightArrow = true;
						break;
				}
			};	  
		  			
			var onKeyUp = function ( event ) {
				switch ( event.keyCode ) {
					case 65: // 
						aKey = false;
						break;
					case 83: // 
						sKey = false;
						break;
                    			case 68: // 
						dKey = false;
						break;
					case 38: // TRASLADAR
						upArrow = false;
						break;
					case 40: // TRASLADAR
						downArrow = false;
						break;
					case 37: // ROTAR CW
						leftArrow = false;
						break;
					case 39: // ROTAR CCW
						rightArrow = false;
						break;
				}
			};	  	
			
			document.addEventListener( 'keydown', onKeyDown, false );
			document.addEventListener( 'keyup', onKeyUp, false );
			
//BASE TAJ MAHAL
	var geobase = new THREE.Geometry();
            

	var res = 20;
 
	var j =-20;
	var i= -20; 
	var k= 0 ;
	var geometry11 = new THREE.BoxGeometry( 60, 0.5, 40 );
	var material11 = new THREE.MeshBasicMaterial( { color:0xAA9489 } );
	var basepiso = new THREE.Mesh( geometry11, material11 );
	scene.add( basepiso );
	var geometry12 = new THREE.BoxGeometry( 50, 3, 0.5 );	
	var geometry13 = new THREE.BoxGeometry( 0.5, 3, 40 );	
	var geometry14 = new THREE.BoxGeometry( 0.5, 3, 17.5 );	
	var geometry15 = new THREE.BoxGeometry( 4.5, 3, 4.5);
	var geometry16 = new THREE.BoxGeometry( 10, 6, 3 );
	var geometry19 = new THREE.BoxGeometry( 9.5, 0.1, 2.5 );
	var geometry17 = new THREE.BoxGeometry( 5, 10, 20 );
	var geometry18 = new THREE.BoxGeometry( 4, 0.5, 7 );
	var material12 = new THREE.MeshBasicMaterial( { color:0x3B3736 } );	
	var material13 = new THREE.MeshBasicMaterial( { color:0xDC7F29} );
	var material14 = new THREE.MeshBasicMaterial( { color:0xD39C68} );
	var material15 = new THREE.MeshBasicMaterial( { color:0xF89639} );
	var material16 = new THREE.MeshBasicMaterial( { color:0x935820} );
	var material17 = new THREE.MeshBasicMaterial( { color:0x3389E3} );
	var material18 = new THREE.MeshBasicMaterial( { color:0x65727B} );
	var reja1 = new THREE.Mesh( geometry12, material12 );
	reja1.position.y=1.5;
	reja1.position.z=20;
	reja1.position.x=5;
	var reja2 = new THREE.Mesh( geometry12, material12 );
	reja2.position.y=1.5;
	reja2.position.z=-20;
	reja2.position.x=5;
	var reja3 = new THREE.Mesh( geometry13, material12 );
	reja3.position.y=1.5;
	reja3.position.z=0;
	reja3.position.x=30;
	var reja4 = new THREE.Mesh( geometry14, material12 );
	reja4.position.y=1.5;
	reja4.position.z=11;
	reja4.position.x=-20;
	var reja5 = new THREE.Mesh( geometry14, material12 );
	reja5.position.y=1.5;
	reja5.position.z=-11;
	reja5.position.x=-20;
	var porteria = new THREE.Mesh( geometry15, material13 );
	porteria.position.y=1.5;
	porteria.position.z=0;
	porteria.position.x=-18;
	var bloque1 = new THREE.Mesh( geometry16, material14 );
	bloque1.position.y=3;
	bloque1.position.z=0;
	bloque1.position.x=0;
	var bloque2 = new THREE.Mesh( geometry16, material14 );
	bloque2.position.y=3;
	bloque2.position.z=-7;
	bloque2.position.x=0;
	var bloque3 = new THREE.Mesh( geometry16, material14 );
	bloque3.position.y=3;
	bloque3.position.z=7;
	bloque3.position.x=0;
	var tbloque1 = new THREE.Mesh( geometry19, material18);
	tbloque1.position.y=6.2;
	tbloque1.position.z=0;
	bloque1.position.x=0;
	var tbloque2 = new THREE.Mesh( geometry19, material18);
	tbloque2.position.y=6.2;
	tbloque2.position.z=-7;
	tbloque2.position.x=0;
	var tbloque3 = new THREE.Mesh( geometry19, material18 );
	tbloque3.position.y=6.2;
	tbloque3.position.z=7;
	tbloque3.position.x=0;
	var bloque4 = new THREE.Mesh( geometry17, material15 );
	bloque4.position.y=3;
	bloque4.position.z=0;
	bloque4.position.x=7.5;
	var bloque5 = new THREE.Mesh( geometry17, material16 );
	bloque5.position.y=3;
	bloque5.position.z=0;
	bloque5.position.x=25.5;
	var canchas = new THREE.Mesh( geometry18, material17 );
	canchas.position.y=0.2;
	canchas.position.z=10;
	canchas.position.x=-17;
	var canchas2 = new THREE.Mesh( geometry18, material17 );
	canchas2.position.y=0.2;
	canchas2.position.z=10;
	canchas2.position.x=-12;
	
	scene.add( reja1 );
	scene.add( reja2 );
	scene.add( reja3 );	
	scene.add( reja4 );
	scene.add( reja5 );
	scene.add( porteria );
	scene.add( bloque1 );
	scene.add( bloque2 );
	scene.add( bloque3 );
	scene.add( tbloque1 );
	scene.add( tbloque2 );
	scene.add( tbloque3 );
	scene.add( bloque4 );
	scene.add( bloque5 );
	scene.add( canchas );
	scene.add( canchas2 );
			
			
	//CREAR LOS MATERIALES            
			
	var matPunto = new THREE.PointsMaterial( { color: 0xF6FC03, size: 0.1 } );
			
			
	//CREAR LOS OBJETOS
			
//TORRES ESQUINERAS TAJ MAHAL
	var geocilindro1 = new THREE.Geometry();
            

	var res = 25;
 
	var anch = 1.1;
	var j =0; 
	var k= 0; 
 	while (k!= 10){        
			while (j!= 25){              
                    
 				var punto = new THREE.Vector3();
                    
				punto.x = anch * Math.cos((j*2*Math.PI)/res) ;
                    
				punto.y = k;
                    
				punto.z = anch * Math.sin((j*2*Math.PI)/res);


				j=j+0.5;  
				geocilindro1.vertices.push( punto );
				}


			j= 0;
			k= k + 0.5;
			}
			
			
	//CREAR LOS MATERIALES   

	         
			
	var matPunto = new THREE.PointsMaterial( { color: 0xBFC2C4, size: 2 } );
			
			
	//CREAR LOS OBJETOS
			
	var CILINDRO1 = new THREE.Points( geocilindro1, matPunto )
	CILINDRO1.position.y=0;
	CILINDRO1.position.z= 18;
	CILINDRO1.position.x= 28;
	scene.add( CILINDRO1);
	var CILINDRO2 = new THREE.Points( geocilindro1, matPunto )
	CILINDRO2.position.y=0;
	CILINDRO2.position.z= -18;
	CILINDRO2.position.x= 28;
	scene.add( CILINDRO2 );
	var CILINDRO3 = new THREE.Points( geocilindro1, matPunto )
	CILINDRO3.position.y=0;
	CILINDRO3.position.z= -18;
	CILINDRO3.position.x= -18;
	scene.add( CILINDRO3 );
	var CILINDRO4 = new THREE.Points( geocilindro1, matPunto )
	CILINDRO4.position.y=0;
	CILINDRO4.position.z= 18;
	CILINDRO4.position.x= -18;
	scene.add( CILINDRO4 );
	

	

	
//CUPULA
		var circleGeometry3 = new THREE.Geometry();
		var re = 180;
		var re2 = 360;

		for(var j=-180; j<re; j++){
  		     for(var i=-360; i<re2; i++){
         		var punto = new THREE.Vector3();
				punto.y= 2* Math.cos(Math.PI*j/re);	
				punto.x = 2 * Math.cos(Math.PI*i/re2)*Math.sin(Math.PI*j/re); 					
		        	punto.z = 2 * Math.sin(Math.PI*i/re2)*Math.sin(Math.PI*j/re);
				if( punto.y<= -0.85){
					break;
				}
         		circleGeometry3.vertices.push(punto); 				
  		   }
 		}
         
		var mater = new THREE.PointsMaterial({color:0xFFFFFF, size: 0.01}); 
		var circle = new THREE.Points(circleGeometry3, mater)
		circle.position.y=9;
		circle.position.z=0;
		circle.position.x=7.5;
		scene.add(circle);

		


//TORRES ESQUINERAS TAJ MAHAL
	var geocilindro1 = new THREE.Geometry();
            

	var res = 25;
 
	var anch = 0.2;
	var j =0; 
	var k= 0; 
 	while (k!= 5){        
			while (j!= 25){              
                    
 				var punto = new THREE.Vector3();
                    
				punto.x = anch * Math.cos((j*2*Math.PI)/res) ;
                    
				punto.y = k;
                    
				punto.z = anch * Math.sin((j*2*Math.PI)/res);


				j=j+0.5;  
				geocilindro1.vertices.push( punto );
				}


			j= 0;
			k= k + 0.5;
			anch= anch - 0.02;
			}
			
			
	//CREAR LOS MATERIALES            
			
	var matPunto = new THREE.PointsMaterial( { color: 0xCFEF1B, size: 0.1 } );

	var matPunto2 = new THREE.PointsMaterial( { color: 0xFFFFFF, size: 0.1 } );			
			
	//CREAR LOS OBJETOS
			
	var PUNTA1 = new THREE.Points( geocilindro1, matPunto )
	PUNTA1.position.y=16;
	PUNTA1.position.z= 19;
	PUNTA1.position.x= 19;
	var PUNTA2 = new THREE.Points( geocilindro1, matPunto )
	PUNTA2.position.y=16;
	PUNTA2.position.z= -19;
	PUNTA2.position.x= -19;
	var PUNTA3 = new THREE.Points( geocilindro1, matPunto )
	PUNTA3.position.y=16;
	PUNTA3.position.z= -19;
	PUNTA3.position.x= 19;
	var PUNTA4 = new THREE.Points( geocilindro1, matPunto )
	PUNTA4.position.y=16;
	PUNTA4.position.z= 19;
	PUNTA4.position.x= -19;
	var PUNTA5 = new THREE.Points( geocilindro1, matPunto2 )
	PUNTA5.position.y=9.5;
	PUNTA5.position.z= 8.5;
	PUNTA5.position.x= 9;
	var PUNTA6 = new THREE.Points( geocilindro1, matPunto2 )
	PUNTA6.position.y=9.5;
	PUNTA6.position.z= -7;
	PUNTA6.position.x= 9;
	var PUNTA7 = new THREE.Points( geocilindro1, matPunto2 )
	PUNTA7.position.y=9.5;
	PUNTA7.position.z= 8.5;
	PUNTA7.position.x= -7;
	var PUNTA8 = new THREE.Points( geocilindro1, matPunto2 )
	PUNTA8.position.y=9.5;
	PUNTA8.position.z= -7;
	PUNTA8.position.x= -7;
//PUNTA CUPULA CENTRAL 
	var geocilindro12 = new THREE.Geometry();
            

	var res = 25;
 
	var anch = 0.4;
	var j =0; 
	var k= 0; 
 	while (k!= 8){        
			while (j!= 25){              
                    
 				var punto = new THREE.Vector3();
                    
				punto.x = anch * Math.cos((j*2*Math.PI)/res) ;
                    
				punto.y = k;
                    
				punto.z = anch * Math.sin((j*2*Math.PI)/res);


				j=j+0.5;  
				geocilindro12.vertices.push( punto );
				}


			j= 0;
			k= k + 0.5;
			anch= anch - 0.02;
			}
			
			
	//CREAR LOS MATERIALES            
			
	var matPunto2 = new THREE.PointsMaterial( { color: 0xFFFFFF, size: 0.1 } );			
			
	//CREAR LOS OBJETOS
			
	var PUNTAC = new THREE.Points( geocilindro12, matPunto2 )
	PUNTAC.position.y=16.5 ;
	PUNTAC.position.z= 0;
	PUNTAC.position.x= 0;


  	for (var i = -size; i <= size; i += steps) {
//draw lines one way
		geometry.vertices.push(new THREE.Vector3(-size, -0.04, i));
		geometry.vertices.push(new THREE.Vector3(size, -0.04, i));

//draw lines the other way
		geometry.vertices.push(new THREE.Vector3(i, -0.04, -size));
		geometry.vertices.push(new THREE.Vector3(i, -0.04, size));
 	 }

//THREE.LinePieces prevents connecting of vertices
	var line = new THREE.LineSegments(geometry, material, THREE.LinePieces);

  	scene.add(line);


//resize viewport
	window.addEventListener('resize', function(){
	var width = window.innerWidth;
	var height = window.innerHeight;
	renderer.setSize( width, height);

	camera.aspect = width / height; 
	camera.updateProjectionMatrix();
	});

	//ELEMENTOS DE ESCENA
							  
			var size = 100;
			var arrowSize = 1;
			var divisions = size;
			var origin = new THREE.Vector3( 0, 0, 0 );
			var x = new THREE.Vector3( 1, 0, 0 );
			var y = new THREE.Vector3( 0, 1, 0 );
		  	var z = new THREE.Vector3( 0, 0, 1 );
			var color1 = new THREE.Color( 0xFFFFFF );
		  	var color2 = new THREE.Color( 0x333333 );
		  	var colorR = new THREE.Color( 0xAA0000 );
		  	var colorG = new THREE.Color( 0x00AA00 );
		  	var colorB = new THREE.Color( 0x0000AA );
			var colorRd = new THREE.Color( 0xAA6666 );
		  	var colorGd = new THREE.Color( 0x66AA66 );
		  	var colorBd = new THREE.Color( 0x6666AA );
		  
		  	//CREAR LAS GRILLAS PARA EL ESCENARIO
		  	var axesHelper1 = new THREE.AxesHelper( size/100 );
			var axesHelper2 = new THREE.AxesHelper( size/100 );
			var axesHelper3 = new THREE.AxesHelper( size/100);
			var axesHelper4 = new THREE.AxesHelper( size/100 );
			var axesHelper5 = new THREE.AxesHelper( size/100 );		
			var axesHelper6 = new THREE.AxesHelper( size/100 );
			var axesHelper7 = new THREE.AxesHelper( size/100 );
			var axesHelper8 = new THREE.AxesHelper( size/100 );
			var axesHelper9 = new THREE.AxesHelper( size/100);
			var axesHelper10 = new THREE.AxesHelper( size/100 );
			var axesHelper11 = new THREE.AxesHelper( size/100 );		
			var axesHelper12 = new THREE.AxesHelper( size/100 );
			var axesHelper13 = new THREE.AxesHelper( size/100 );
			var axesHelper14 = new THREE.AxesHelper( size/100 );
			var axesHelper15 = new THREE.AxesHelper( size/100);
			var axesHelper16 = new THREE.AxesHelper( size/100 );
			
		  	var gridHelperXY = new THREE.GridHelper( size, divisions, color1, color1);
		  	var gridHelperXZ = new THREE.GridHelper( size, divisions, color2, color2 );
		  	var gridHelperYZ = new THREE.GridHelper( size, divisions, color2, color2 );

	
            
            //ROTARLAS PARA QUE QUEDEN EN EL ESPACIO ADECUADO
            gridHelperXY.rotateOnWorldAxis ( x, THREE.Math.degToRad(90) );
            gridHelperXZ.rotateOnWorldAxis ( y, THREE.Math.degToRad(90) );
            gridHelperYZ.rotateOnWorldAxis ( z, THREE.Math.degToRad(90) );
            
            //CREAR LAS FLECHAS QUE INDICAN LOS EJES DE COORDENADAS 3D
            var arrowX = new THREE.ArrowHelper( x, origin, arrowSize, colorR );
            var arrowY = new THREE.ArrowHelper( y, origin, arrowSize, colorG );
            var arrowZ = new THREE.ArrowHelper( z, origin, arrowSize, colorB );
			
			//CREAR LAS GEOMETRÍAS
		// CUERPO
		var circleGeometry= new THREE.Geometry();
		var re = 180;
		var re2 = 360;

		for(var j=-180; j<re; j++){
  		     for(var i=-360; i<re2; i++){
         		var line = new THREE.Vector3();
				line.x = 1.15 * Math.cos(Math.PI*j/re);	
				line.z = 1.15 * Math.cos(Math.PI*i/re2)*Math.sin(Math.PI*j/re); 					
		        line.y = 0.7 * Math.sin(Math.PI*i/re2)*Math.sin(Math.PI*j/re);
				if( line.x >= 4){
					break;
				}
         		circleGeometry.vertices.push(line); 				
  		   }
 		}

		//CABEZA
		var circleGeometry1= new THREE.Geometry();
		var re = 180;
		var re2 = 360;

		for(var j=-180; j<re; j++){
  		     for(var i=-360; i<re2; i++){
         		var line = new THREE.Vector3();
				line.x = 0.5 * Math.cos(Math.PI*j/re);	
				line.z = 0.5 * Math.cos(Math.PI*i/re2)*Math.sin(Math.PI*j/re); 					
		        line.y = 0.3 * Math.sin(Math.PI*i/re2)*Math.sin(Math.PI*j/re);
				if( line.x >= 4){
					break;
				}
         		circleGeometry1.vertices.push(line); 				
  		   }
 		}

		//COLA
		var circleGeometry2= new THREE.Geometry();
		var re = 180;
		var re2 = 360;

		for(var j=-180; j<re; j++){
  		     for(var i=-360; i<re2; i++){
         		var line = new THREE.Vector3();
				line.x = 1.5 * Math.cos(Math.PI*j/re);	
				line.z = 2.5 * Math.cos(Math.PI*i/re2)*Math.sin(Math.PI*j/re); 					
		        line.y = 01 * Math.sin(Math.PI*i/re2)*Math.sin(Math.PI*j/re);
				if( line.x >= 4){
					break;
				}
         		circleGeometry2.vertices.push(line); 				
  		   }
 		}
          

		//PATAS
			geometry2 = new THREE.CylinderGeometry( .125, .125, 2, 32 );
			for ( var i = 0; i < geometry2.faces.length; i++) { 
				if( geometry2.faces[i].normal.y != 0) { 
					geometry2.faces[i].color = colorGd; 
				} 
			}
			geometry3 = new THREE.CylinderGeometry( .125, .065, 2, 32 );
			for ( var i = 0; i < geometry3.faces.length; i++) { 
				if( geometry3.faces[i].normal.y != 0) { 
					geometry3.faces[i].color = colorGd; 
				} 
			}
			geometry4 = new THREE.CylinderGeometry( .065, .02, 2, 32 );
			for ( var i = 0; i < geometry4.faces.length; i++) { 
				if( geometry4.faces[i].normal.y != 0) { 
					geometry4.faces[i].color = colorGd; 
				} 
			}
			
			
			//CREAR LOS MATERIALES

			
			
			var material = new THREE.MeshBasicMaterial( { color:0xECD623, size: 0.001 } );
			var material22 = new THREE.MeshBasicMaterial( { color:0xBAAB32, size: 0.001 } );
			var material33 = new THREE.MeshBasicMaterial( { color:0x766C1F, size: 0.001 } );
			var material2 = new THREE.MeshBasicMaterial({color:0x7A2B2B, size: 0.1});
			var material3 = new THREE.MeshBasicMaterial({color:0xBC3737, size: 0.1});
			
			//CREAR LOS OBJETOS
			
			hips2 = new THREE.Line(circleGeometry1, material3);
			hips3 = new THREE.Line(circleGeometry2, material3);
			hips = new THREE.Line(circleGeometry, material2);	//CUBO
			hips.position.y = (0);
			leftFoot = hips.clone();
			
			leftLeg = new THREE.Mesh( geometry2, material ); //CILINDRO
			leftLeg2 = new THREE.Mesh( geometry3, material22 ); //CILINDRO
			leftLeg3 = new THREE.Mesh( geometry4, material33 ); //CILINDRO
			
			left2Leg = new THREE.Mesh( geometry2, material ); //CILINDRO
			left2Leg2 = new THREE.Mesh( geometry3, material22 ); //CILINDRO
			left2Leg3 = new THREE.Mesh( geometry4, material33 ); //CILINDRO

			left3Leg = new THREE.Mesh( geometry2, material ); //CILINDRO
			left3Leg2 = new THREE.Mesh( geometry3, material22 ); //CILINDRO
			left3Leg3 = new THREE.Mesh( geometry4, material33 ); //CILINDRO

			left4Leg = new THREE.Mesh( geometry2, material ); //CILINDRO
			left4Leg2 = new THREE.Mesh( geometry3, material22 ); //CILINDRO
			left4Leg3 = new THREE.Mesh( geometry4, material33 ); //CILINDRO
			
			//axesHelper1 = new THREE.AxesHelper( 1 );	
			leftLeg.applyMatrix( new THREE.Matrix4().makeRotationZ(2.2) );
			leftLeg.applyMatrix( new THREE.Matrix4().makeRotationY(2.84) );
			leftLeg.applyMatrix( new THREE.Matrix4().makeTranslation(-1.5,0.3,-0.5) );
			axesHelper1.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			leftLeg2.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			leftLeg2.applyMatrix( new THREE.Matrix4().makeRotationZ(-0.7) );
			axesHelper2.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			leftLeg3.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			leftLeg3.applyMatrix( new THREE.Matrix4().makeRotationZ(-7) );
			
			left2Leg.applyMatrix( new THREE.Matrix4().makeRotationZ(2.2) );
			left2Leg.applyMatrix( new THREE.Matrix4().makeRotationY(2.34) );
			left2Leg.applyMatrix( new THREE.Matrix4().makeTranslation(-1.3,0.3,-1.7) );
			axesHelper5.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			left2Leg2.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			left2Leg2.applyMatrix( new THREE.Matrix4().makeRotationZ(-0.7) );
			axesHelper6.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			left2Leg3.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			left2Leg3.applyMatrix( new THREE.Matrix4().makeRotationZ(-7) );

			left3Leg.applyMatrix( new THREE.Matrix4().makeRotationZ(2.2) );
			left3Leg.applyMatrix( new THREE.Matrix4().makeRotationY(3.64) );
			left3Leg.applyMatrix( new THREE.Matrix4().makeTranslation(-1.5,0.3,0.5) );
			axesHelper7.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			left3Leg2.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			left3Leg2.applyMatrix( new THREE.Matrix4().makeRotationZ(-0.7) );
			axesHelper8.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			left3Leg3.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			left3Leg3.applyMatrix( new THREE.Matrix4().makeRotationZ(-7) );

			left4Leg.applyMatrix( new THREE.Matrix4().makeRotationZ(2.2) );
			left4Leg.applyMatrix( new THREE.Matrix4().makeRotationY(4.14) );
			left4Leg.applyMatrix( new THREE.Matrix4().makeTranslation(-1,0.3,1.3) );
			axesHelper9.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			left4Leg2.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			left4Leg2.applyMatrix( new THREE.Matrix4().makeRotationZ(-0.7) );
			axesHelper10.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			left4Leg3.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			left4Leg3.applyMatrix( new THREE.Matrix4().makeRotationZ(-7) );

			hips.add(leftLeg);
			leftLeg.add(axesHelper1);			
			axesHelper1.add(leftLeg2);
			leftLeg2.add(axesHelper2);
			axesHelper2.add(leftLeg3);

			hips.add(left2Leg);
			left2Leg.add(axesHelper5);			
			axesHelper5.add(left2Leg2);
			left2Leg2.add(axesHelper6);
			axesHelper6.add(left2Leg3);

			hips.add(left3Leg);
			left3Leg.add(axesHelper7);			
			axesHelper7.add(left3Leg2);
			left3Leg2.add(axesHelper8);
			axesHelper8.add(left3Leg3);

			hips.add(left4Leg);
			left4Leg.add(axesHelper9);			
			axesHelper9.add(left4Leg2);
			left4Leg2.add(axesHelper10);
			axesHelper10.add(left4Leg3);

			rightLeg = new THREE.Mesh( geometry2, material ); //CILINDRO
			rightLeg2 = new THREE.Mesh( geometry3, material22 ); //CILINDRO
			rightLeg3 = new THREE.Mesh( geometry4, material33 ); //CILINDRO

			right2Leg = new THREE.Mesh( geometry2, material ); //CILINDRO
			right2Leg2 = new THREE.Mesh( geometry3, material22 ); //CILINDRO
			right2Leg3 = new THREE.Mesh( geometry4, material33 ); //CILINDRO

			right3Leg = new THREE.Mesh( geometry2, material ); //CILINDRO
			right3Leg2 = new THREE.Mesh( geometry3, material22 ); //CILINDRO
			right3Leg3 = new THREE.Mesh( geometry4, material33 ); //CILINDRO

			right4Leg = new THREE.Mesh( geometry2, material ); //CILINDRO
			right4Leg2 = new THREE.Mesh( geometry3, material22 ); //CILINDRO
			right4Leg3 = new THREE.Mesh( geometry4, material33 ); //CILINDRO

			rightLeg.applyMatrix( new THREE.Matrix4().makeRotationZ(4.1) );
			rightLeg.applyMatrix( new THREE.Matrix4().makeRotationY(3.54) );
			rightLeg.applyMatrix( new THREE.Matrix4().makeTranslation(1.5,0.3,-0.5) );
			axesHelper3.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			rightLeg2.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			rightLeg2.applyMatrix( new THREE.Matrix4().makeRotationZ(0.7) );
			axesHelper4.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			rightLeg3.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			rightLeg3.applyMatrix( new THREE.Matrix4().makeRotationZ(7) );

			right2Leg.applyMatrix( new THREE.Matrix4().makeRotationZ(4.1) );
			right2Leg.applyMatrix( new THREE.Matrix4().makeRotationY(4.04) );
			right2Leg.applyMatrix( new THREE.Matrix4().makeTranslation(1.2,0.3,-1.6) );
			axesHelper11.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			right2Leg2.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			right2Leg2.applyMatrix( new THREE.Matrix4().makeRotationZ(0.7) );
			axesHelper12.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			right2Leg3.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			right2Leg3.applyMatrix( new THREE.Matrix4().makeRotationZ(7) );

			right3Leg.applyMatrix( new THREE.Matrix4().makeRotationZ(4.1) );
			right3Leg.applyMatrix( new THREE.Matrix4().makeRotationY(2.84) );
			right3Leg.applyMatrix( new THREE.Matrix4().makeTranslation(1.5,0.3,0.4) );
			axesHelper13.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			right3Leg2.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			right3Leg2.applyMatrix( new THREE.Matrix4().makeRotationZ(0.7) );
			axesHelper14.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			right3Leg3.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			right3Leg3.applyMatrix( new THREE.Matrix4().makeRotationZ(7) );


			right4Leg.applyMatrix( new THREE.Matrix4().makeRotationZ(4.1) );
			right4Leg.applyMatrix( new THREE.Matrix4().makeRotationY(2.14) );
			right4Leg.applyMatrix( new THREE.Matrix4().makeTranslation(1,0.3,1.3) );
			axesHelper15.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			right4Leg2.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			right4Leg2.applyMatrix( new THREE.Matrix4().makeRotationZ(0.7) );
			axesHelper16.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			right4Leg3.applyMatrix( new THREE.Matrix4().makeTranslation(0,-1,0) );
			right4Leg3.applyMatrix( new THREE.Matrix4().makeRotationZ(7) );

			hips2.applyMatrix( new THREE.Matrix4().makeTranslation(0,0,1.2) );
			hips3.applyMatrix( new THREE.Matrix4().makeTranslation(0,0.5,-3) );
	

			hips.add(rightLeg);
			rightLeg.add(axesHelper3);
			axesHelper3.add(rightLeg2);
			rightLeg2.add(axesHelper4);
			axesHelper4.add(rightLeg3);

			hips.add(right2Leg);
			right2Leg.add(axesHelper11);
			axesHelper11.add(right2Leg2);
			right2Leg2.add(axesHelper12);
			axesHelper12.add(right2Leg3);

			hips.add(right3Leg);
			right3Leg.add(axesHelper13);
			axesHelper13.add(right3Leg2);
			right3Leg2.add(axesHelper14);
			axesHelper14.add(right3Leg3);

			hips.add(right4Leg);
			right4Leg.add(axesHelper15);
			axesHelper15.add(right4Leg2);
			right4Leg2.add(axesHelper16);
			axesHelper16.add(right4Leg3);

			hips.add(hips2);
			hips.add(hips3);

		
		  	//AGREGAR A LA ESCENA
            		scene.add( gridHelperXZ );
		  	scene.add( arrowX );	
		  	scene.add( arrowY );	
		  	scene.add( arrowZ );	
			scene.add( hips );
			
			}

		
 			function animate() {
        		render();
        		requestAnimationFrame( animate );
    			}

	function render() {
		//using timer as animation
		var speed = Date.now() * 0.00025;
		console.log(camera.rotation);
				

		if(aKey) {
			camera.position.x = Math.cos(speed)*  50;
			camera.position.y = 25;
			camera.position.z =  Math.sin(speed)* 50;
		}
		if(sKey) {
			camera.position.x = 25;
			camera.position.y = Math.cos(speed)*  50
			camera.position.z = Math.sin(speed)* 50;
		
		}
        	if(dKey) {
			camera.position.x = Math.cos(speed)*  50;
			camera.position.y = Math.sin(speed)* 50;
			camera.position.z = 25;
		}

		var dtime = Date.now()-startTime;
		var tx=0, ty=0, tz=0;	//Variables para traslacion
		var sc = 1;				//Variable para escala
		var theta=0;			//Variable para ángulo de rotacion de piernas
		var sigma=0;			//Variable para ángulo de rotación de caderas
		
		if(thetaSum>=10*Math.PI/90)
			positivo = false;
		if(thetaSum<=-10*Math.PI/90)
			positivo = true;
		
		if(upArrow) {
			tx=0; ty=0; tz=0.25;
			if(positivo)
				theta = .05;
			else
				theta = -.05;
		}
		
		if(downArrow) {
			tx=0; ty=0; tz=-0.25;
			if(positivo)
				theta = .05;
			else
				theta = -.05;
		}
		thetaSum+=theta;
		
		if(rightArrow)
			sigma = -.05;	
			
		if(leftArrow)
			
			sigma = .05;
			
			
		//MATRIZ DE TRASLACIÓN
		var t = new THREE.Matrix4();
		t.set( 	1, 0, 0, tx,
				0, 1, 0, ty, 
				0, 0, 1, tz,
				0, 0, 0, 1	);
		
		hips.matrix.multiply(t); 	//APLICAR LA TRASLACIÓN A NIVEL LOCAL
		
		//ROTACIONES
		var ct1 = Math.cos(theta);
		var ct2 = Math.cos(-theta);
		var cs = Math.cos(sigma);
		var st1 = Math.sin(theta);
		var st2 = Math.sin(-theta);
		var ss = Math.sin(sigma);
		var r = new THREE.Matrix4();
		var r1 = new THREE.Matrix4();
		var r2 = new THREE.Matrix4();


		//MATRIZ DE ROTACIÓN EN EJE Y
		r.set( 	   cs,  0, ss, 0,
					0,  1,  0, 0, 
				  -ss,  0, cs, 0,
					0,  0,  0, 1 );	
		//MATRICES DE ROTACIÓN EN EJE LOCAL DE PIERNAS	
		r1.set( 	1,  0,  0, 0,
					0, ct1,-st1, 0, 
					0, st1, ct1, 0,
					0,  0,  0, 1 );	
		r2.set( 	1,  0,  0, 0,
					0, ct2,-st2, 0, 
					0, st2, ct2, 0,
					0,  0,  0, 1 );

		
		//ROTACION EN UN EJE PARALELO
		var tempMatrix = new THREE.Matrix4();
		tempMatrix.copyPosition( hips.matrix );
		hips.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix) );
		hips.applyMatrix(r);
		hips.applyMatrix( tempMatrix );

		
		rightLeg.applyMatrix(r2);
		
		//ROTACION EN UN EJE PARALELO
		var tempMatrix2 = new THREE.Matrix4();
		tempMatrix2.copyPosition( axesHelper1.matrix );
		leftLeg2.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		leftLeg2.applyMatrix(r1);
		leftLeg2.applyMatrix( tempMatrix2 );
		leftLeg3.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		leftLeg3.applyMatrix(r1);
		leftLeg3.applyMatrix( tempMatrix2 );
		
		left2Leg2.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		left2Leg2.applyMatrix(r2);
		left2Leg2.applyMatrix( tempMatrix2 );
		left2Leg3.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		left2Leg3.applyMatrix(r2);
		left2Leg3.applyMatrix( tempMatrix2 );
	
		left3Leg2.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		left3Leg2.applyMatrix(r2);
		left3Leg2.applyMatrix( tempMatrix2 );
		left3Leg3.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		left3Leg3.applyMatrix(r2);
		left3Leg3.applyMatrix( tempMatrix2 );	

		left4Leg2.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		left4Leg2.applyMatrix(r1);
		left4Leg2.applyMatrix( tempMatrix2 );
		left4Leg3.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		left4Leg3.applyMatrix(r1);
		left4Leg3.applyMatrix( tempMatrix2 );
		
		rightLeg2.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		rightLeg2.applyMatrix(r2);
		rightLeg2.applyMatrix( tempMatrix2 );
		rightLeg3.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		rightLeg3.applyMatrix(r2);
		rightLeg3.applyMatrix( tempMatrix2 );

		right2Leg2.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		right2Leg2.applyMatrix(r1);
		right2Leg2.applyMatrix( tempMatrix2 );
		right2Leg3.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		right2Leg3.applyMatrix(r1);
		right2Leg3.applyMatrix( tempMatrix2 );

		right3Leg2.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		right3Leg2.applyMatrix(r1);
		right3Leg2.applyMatrix( tempMatrix2 );
		right3Leg3.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		right3Leg3.applyMatrix(r1);
		right3Leg3.applyMatrix( tempMatrix2 );

		right4Leg2.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		right4Leg2.applyMatrix(r2);
		right4Leg2.applyMatrix( tempMatrix2 );
		right4Leg3.applyMatrix( new THREE.Matrix4().getInverse(tempMatrix2) );
		right4Leg3.applyMatrix(r2);
		right4Leg3.applyMatrix( tempMatrix2 );
	
		camera.lookAt(0,0,0); //0,0,0
		renderer.render(scene, camera);
	}
			
		</script>
	</body>
</html>